/* File: spells3.c *//* Purpose: Spell code (part 3) *//* * Copyright (c) 1989 James E. Wilson, Robert A. Koeneke * * This software may be copied and distributed for educational, research, and * not for profit purposes provided that this copyright and statement are * included in all such copies. */#include "angband.h"/* * Turns an object into gold, gain some of its value in a shop */bool alchemy(void){	int item, amt = 1;	int old_number;	long price;	bool force = FALSE;	object_type *o_ptr;	char o_name[256];	char out_val[512];	cptr q, s;	/* Hack -- force destruction */	if (p_ptr->command_arg > 0) force = TRUE;	/* Get an item */	q = "Turn which item to gold? ";	s = "You have nothing to turn to gold.";	if (!get_item(&item, q, s, (USE_INVEN | USE_FLOOR))) return (FALSE);	/* Get the item (in the pack) */	if (item >= 0)	{		o_ptr = &inventory[item];	}	/* Get the item (on the floor) */	else	{		o_ptr = &o_list[0 - item];	}	/* See how many items */	if (o_ptr->number > 1)	{		/* Get a quantity */		amt = get_quantity(NULL, o_ptr->number);		/* Allow user abort */		if (amt <= 0) return FALSE;	}	/* Describe the object */	old_number = o_ptr->number;	o_ptr->number = amt;	object_desc(o_name, o_ptr, TRUE, 3);	o_ptr->number = old_number;	/* Verify unless quantity given */	if (!force)	{		if (object_value(o_ptr) < 1)		{			/* Make a verification */			sprintf(out_val, "Really turn %s to gold? ", o_name);			if (!get_check(out_val)) return FALSE;		}	}	price = object_value(o_ptr);	if (price <= 0)	{		/* Message */		msg_format("You turn %s to fool's gold.", o_name);	}	else	{		price /= 3;		if (amt > 1) price *= amt;		if (price > 30000) price = 30000;		msg_format("You turn %s to %ld coins worth of gold.", o_name, price);		p_ptr->au += price;		/* Redraw gold */		p_ptr->redraw |= (PR_GOLD);		/* Window stuff */		p_ptr->window |= (PW_PLAYER_0 | PW_PLAYER_1);	}	/* Eliminate the item (from the pack) */	if (item >= 0)	{		inven_item_increase(item, -amt);		inven_item_describe(item);		inven_item_optimize(item);	}	/* Eliminate the item (from the floor) */	else	{		floor_item_increase(0 - item, -amt);		floor_item_describe(0 - item);		floor_item_optimize(0 - item);	}	return TRUE;}